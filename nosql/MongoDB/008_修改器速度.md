# 修改器速度

有的修改器运行比较快。`$inc` 能就地修改，因为不需要改变文档的大小，只需要构建的值改一下(对文档大小的改变非常小)，所以非常快。而数组修改器可能会改变文档的大小，就会慢一些(`$set` 能在文档大小不发生变化时立即修改它，否则性能也会有所下降)。

将文档插入到 `MongoDB` 中时，依次插入的文档在磁盘上的位置是相邻的。因此，如果一个文档变大了，原先的位置就放不下这个文档了，这个文档就会被移动到集合中的另一个位置。

可以在实际操作中看到这种变化。创建一个包含几个文档的集合，对某个位于中间的文档进行修改，使其尺寸变大。然后会发现这个文档被移动到了集合的尾部：

```js
> db.coll.insert({"x": "a"})
> db.coll.insert({"x": "b"})
> db.coll.insert({"x": "c"})
> db.coll.find()
{ "_id" : ObjectId("612cd420ba28c1562338eb40"), "x" : "a" }
{ "_id" : ObjectId("612cd423ba28c1562338eb41"), "x" : "b" }
{ "_id" : ObjectId("612cd426ba28c1562338eb42"), "x" : "c" }
> db.coll.update({"x": "b"}, {$set: {"x": "bbb"}})
WriteResult({ "nMatched" : 1, "nUpserted" : 0, "nModified" : 1 })
> db.coll.find()
{ "_id" : ObjectId("612cd420ba28c1562338eb40"), "x" : "a" }
{ "_id" : ObjectId("612cd426ba28c1562338eb42"), "x" : "c" }
{ "_id" : ObjectId("612cd423ba28c1562338eb41"), "x" : "bbb" }
```

`MongoDB` 不得不移动一个文档时，他会修改集合的**填充因子(paddingFactor)**。填充因子是 `MongoDB` 为每个新文档预留的增长空间。(不过我用了 `MongoDB 4` 并不会有这样的结果，可能是配置，也可能是后续版本优化了)

可以运行 `db.coll.stats()` 查看填充因子。执行上面的更新之前，`paddingFactor` 字段的值是 1：根据实际的文档大小，为每个新文档分配精确的空间，不预留任何增长空间，如图所示。

