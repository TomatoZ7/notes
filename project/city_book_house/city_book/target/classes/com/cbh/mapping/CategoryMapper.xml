<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.cbh.dao.CategoryDao">
	<resultMap id="category" type="com.cbh.domain.Category">
        <result property="id" column="id"/>
        <result column="category_name" property="category_name"/>
        <result column="pid" property="pid"/>
        
        <collection property="firstCate" ofType="com.cbh.domain.Category">
        	<id column="cid" property="id" />
        	<result column="parent_name" property="category_name"/>
        </collection>
    </resultMap>

    <resultMap id="categoryCount" type="java.lang.Integer">
        <result column="count"/>
    </resultMap>
    
    <!-- 列表查询 -->
    <select id="getCategoryList" parameterType="Map" resultMap="category categoryCount">
        SELECT SQL_CALC_FOUND_ROWS 
        	cate.*, c.id as cid, c.category_name as parent_name
        FROM 
        	cb_category AS cate
        	LEFT JOIN cb_category AS c ON cate.pid = c.id
        WHERE 
        	cate.pid > 0
        ORDER BY 
        	id DESC 
        LIMIT #{limit} OFFSET #{offset};
        
        SELECT FOUND_ROWS() as count;
    </select>
    
    <!-- 单条记录查询 -->
    <select id="getCategoryById" resultMap="category">
        SELECT 
        	cate.*, c.id as cid, c.category_name as parent_name 
       	FROM 
       		cb_category AS cate
       		LEFT JOIN cb_category AS c ON cate.pid = c.id
     	WHERE id=#{id};
    </select>
</mapper>