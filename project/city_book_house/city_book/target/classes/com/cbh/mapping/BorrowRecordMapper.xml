<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 <mapper namespace="com.cbh.dao.BorrowRecordDao">
     <resultMap id="list" type="com.cbh.domain.BorrowRecord">
        <result property="id" column="id"/>
        <result column="user_id" property="user_id"/>
        <result column="book_id" property="book_id"/>
        <result column="status" property="status"/>
        <result column="start_time" property="start_time"/>
        <result column="end_time" property="end_time"/>
        <result column="create_time" property="create_time"/>
        
        <collection property="user" ofType="com.cbh.domain.User">
        	<id column="userid" property="id" />
        	<result column="name" property="name"/>
        </collection>
        
        <collection property="book" ofType="com.cbh.domain.Book">
        	<id column="bookid" property="id" />
        	<result column="book_name" property="book_name"/>
        </collection>
        
    </resultMap>
    	
    <resultMap id="recordCount" type="java.lang.Integer">
        <result column="count"/>
    </resultMap>
 	
 	<!-- 列表查询 -->
    <select id="getBorrowRecordList" parameterType="Map" resultMap="list, recordCount">
    	<!-- 连表查询 -->
    	SELECT SQL_CALC_FOUND_ROWS 
        	record.*,
        	user.id AS userid, user.name,
        	book.id AS bookid, book.book_name
        FROM
			cb_borrow_record AS record
        	LEFT JOIN cb_user AS user ON user.id = record.user_id
        	LEFT JOIN cb_books AS book ON book.id = record.book_id
        ORDER BY 
        	id DESC LIMIT #{limit} OFFSET #{offset};
        SELECT FOUND_ROWS() as count;
    </select>
 </mapper>