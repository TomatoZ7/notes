# 消息队列协议

## 一、什么是协议

消息中间件负责数据的传递，存储和分发消费三个部分，数据的存储和分发的过程中肯定要遵循某种约定俗成的规范，比如是采用底层的 TCP/IP，UDP 协议还是其他的自己去构建等，这些约定俗成的规范就称之为**协议**。

> 所谓协议是指：
>
> 1、计算机底层的操作系统和应用程序通讯时共同遵守的一组约定，只有遵循共同的约定和规范，系统和底层操作系统之间才能相互交流。<br/>
> 2、协议对数据格式和计算机之间交互数据都必须严格遵守规范。

## 二、网络协议的三要素

1、语法 : 语法是用户数据与控制信息的结构与格式，以及数据出现的顺序。

2、语义 : 语义是解释控制信息每个部分的意义。它规定了需要发出何种控制信息，以及完成的动作和做出什么样的响应。

3、时序 : 时序是对事件发生顺序的详细说明。

举个例子，比如 MQ 发送一个消息，是以什么数据格式发送到队列中，每个部分的含义是什么，发送完毕以后的执行动作，以及消费者消费信息的动作，消费完毕的响应结果和反馈是什么，然后按照对应的执行顺序进行处理。

类比于 http 协议：

1、语法 : http 规定了请求报文和响应报文的格式。

2、语义 : 客户端主动发起请求(Get/Post)。

3、时序 : 一个请求对应一个响应。(一定是有请求再有响应，这便是时序)

而消息中间件采用的并不是 http 协议，常见的消息中间件协议有：OpenWire、AMQP、MQTT、Kafka、OpenMessage 协议。

> 问 : 为什么消息中间件不直接使用 http 协议？
>
> 答 : <br/>
> 1) 因为 http 请求头和响应头是比较复杂的，包含了 cookie，数据加密解密，状态/响应码等附加功能。对于一个消息而言，并不需要这么复杂的功能，它只负责数据传递、存储、分发就行，追求的是高性能，简洁，快速。<br/>
> 2) 大部分情况下 http 是短连接。一个请求-响应如果中断会造成数据的丢失，无法持久化，这样不利于消息中间件的业务场景。消息中间件可能是一个长期获取消息的过程，出现故障需要对消息数据进行持久化，目的是为了保证消息数据的高可靠和稳健的运行。

## 三、小结

协议 : 是在 tcp/ip 协议基础上构建的一种约定成俗的规范和机制、它的主要目的是可以让客户端(应用程序 java，go)进行沟通和通讯。并且在这种协议下规范必须具有持久性、高可用、高可靠的性能。