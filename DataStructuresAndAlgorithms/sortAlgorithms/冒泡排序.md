# 冒泡排序

冒泡排序是基于比较的算法。冒泡排序只会操作相邻的两个数据。每次冒泡操作都会对相邻的两个元素进行比较，看是否满足大小关系要求。如果不满足就让它俩互换。一次冒泡会让至少一个元素移动到它应该在的位置，重复 n 次，就完成了 n 个数据的排序工作。

在此基础上，冒泡排序还可以优化。当某次冒泡操作已经没有数据交换时，说明已经达到完全有序，不用再继续执行后续的冒泡操作。

### 代码实现

```php
// php
function bubbleSort(&$arr = []) {
    $count = count($arr);

    if (0 == $count) {
        return;
    }

    for ($i=0; $i < $count; $i++) { 
        // 提前退出冒泡循环的标志位
        $no_exchange = true;

        for ($j=0; $j < $count - $i - 1; $j++) { 
            if ($arr[$j] > $arr[$j+1]) {
                list($arr[$j+1], $arr[$j]) = [$arr[$j], $arr[$j+1]];

                $no_exchange = false;   // 表示有数据交换
            }
        }

        // 没有数据交换，提前退出
        if ($no_exchange) {
            break;  
        }
    }
}
```

### 冒泡排序是原地排序算法吗

冒泡的过程只涉及相邻数据的交换操作，只需要常量级的临时空间，所以它的空间复杂度为 O(1)，是一个原地排序算法。

### 冒泡排序是稳定的排序算法吗？

在冒泡排序中，只有交换才可以改变两个元素的前后顺序。为了保证冒泡排序算法的稳定性，当有相邻的两个元素大小相等的时候，我们不做交换，相同大小的数据在排序前后不会改变顺序，所以冒泡排序是稳定的排序算法。

### 冒泡排序的时间复杂度是多少？

最好情况下，要排序的数据已经是有序的了，我们只需要进行一次冒泡操作，就可以结束了，所以最好情况时间复杂度是 `O(n)`。

而最坏的情况是，要排序的数据刚好是倒序排列的，我们需要进行 n 次冒泡操作，所以最坏情况时间复杂度为 `O(n^2)`。

平均情况下的时间复杂度是 `O(n^2)`。

### 平均时间复杂度分析

#### 有序度和逆序度

这里借助 **有序度** 和 **无序度** 两个概念进行推导。

**有序度**是数组中具有有序关系的元素对的个数。有序元素对用数学表达式表示就是这样：

```php
有序元素对：$a[$i] <= $a[$j], 如果$i < $j。
```

举个例子，对于 `2,4,1,3,5,6` 这组数据的**有序度**为 11，因其有序元素对的个数为 11，分别是：

```
(2,4) (2,3) (2,5) (2,6)
(4,5) (4,6)
(1,3) (1,5) (1,6)
(3,5) (3,6)
(5,6)
```

同理，对于一个倒序排列的数组，如 `6,5,4,3,2,1` 有序度是 0；对于一个完全有序的数组 `1,2,3,4,5,6`，有序度就是 `n*(n-1)/2`，也就是 15。我们把这种完全有序的数组的有序度称为**满有序度**

逆序度的定义与有序度相反(默认大小从小到大为有序)。

关于这三个概念，我们还可以推导出一个公式：**逆序度 = 满有序度 - 有序度**。我们排序的过程就是一种**增加有序度**，**减少逆序度**的过程，最后达到**满有序度**，就说明排序完成了。

#### 冒泡排序平均时间复杂度分析

冒泡排序包含两个操作原子，**比较**和**交换**。每交换一次，有序度就加 1。不管算法怎么改进，交换次数总是确定的，即为逆序度，也就是 `n*(n-1)/2–初始有序度`。

对于 n 个数据的数组进行冒泡排序，平均交换次数是多少呢？

最坏的情况下，初始状态的有序度为 0，所以要进行 `n*(n-1)/2` 次交换。

最好的情况下，初始状态的有序度是 `n*(n-1)/2`，就不需要进行交换。

我们可以取个中间值 `n*(n-1)/4`，来表示初始有序度既不是很高也不是很低的平均情况。

换句话说，平均情况下，需要 `n*(n-1)/4` 次交换操作。比较操作肯定要比交换操作多，而复杂度上线是 `O(n^2)`，所以平均情况下的时间复杂度就是 `O(n^2)`。

> 这个平均时间复杂度推导过程其实并不严格，但是很多时候很实用，毕竟概率论的定量分析太复杂，不太好用。    —— 王争

## 参考

(数据结构与算法之美 王争)[https://time.geekbang.org/column/article/41802]