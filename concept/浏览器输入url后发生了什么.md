# 面试题：在浏览器地址栏输入 url，按下回车后究竟发生了什么？

## 第一步：浏览器输入域名

例如输入：`www.csdn.net/`

## 第二步：浏览器查找域名的 IP 地址

浏览器会把对应的域名解析成对应的 IP，其过程如下：

### 1、查找浏览器缓存

因为浏览器一般会缓存 DNS 记录一段时间，不同的浏览器时间可能不一样，一般 2-30 分钟不等，浏览器去查找这些缓存，如果有缓存，直接返回 IP，否则下一步。

### 2、查找系统缓存

浏览器缓存找不到 IP 后，浏览器会进行系统调用(windows 是 gethostbyname)，查找本机的 hosts 文件，如果找到，直接返回 IP，否则下一步。

### 3、查找路由器缓存

如果1、2步都查询无果，则需要借助网络，路由器一般都有自己的 DNS 缓存，将前面的请求发给路由器，查找 ISP 服务商缓存 DNS 的服务器，如果查找到 IP 则直接返回，没有的话继续查找。

### 4、递归查询

如果以上步骤都找不到，则 ISP 的 DNS 服务器就会进行递归查询，所谓递归查询就是如果主机所询问的本地域名服务器不知道被查询域名的 IP 地址，那么本地域名服务器就会以 DNS 客户的身份，向其他根域名服务器继续发出查询请求报文，而不是让该主机自己进行下一步查询。(本地域名服务器地址是通过 DHCP 协议获取地址，DHCP 是负责分配 IP 的)

### 5、迭代查询

本地域名服务器采用迭代查询，它先向一个根域名服务器查询。本地域名服务器向根域名服务器的查询一般都是采用迭代查询。所谓迭代查询就是当根域名服务器收到本地域名服务器发出的查询请求报文后，要么告诉本地域名服务器下一步应该查询哪一个域名服务器，然后本地域名服务器自己进行后续的查询。（而不是替代本地域名服务器进行后续查询）。

本例子中：根域名服务器告诉本地域名服务器，下一次应查询的顶级域名服务器 `dns.net` 的 IP 地址。本地域名服务器向顶级域名服务器 `dns.net` 进行查询。
顶级域名服务器 `dns.net` 告诉本地域名服务器，下一次应查询的权限域名服务器 `dns.csdn.net` 的 IP 地址。
本地域名服务器向权限域名服务器 `dns.csdn.net` 进行查询。权限域名服务器 `dns.csdn.net` 告诉本地域名服务器，所查询的主机 `www.csdn.net` 的 IP 地址。
本地域名服务器最后把结果告诉主机。

## 第三步、浏览器与目标服务器建立 TCP 连接

1. 主机浏览器通过 DNS 解析得到了目标服务器的 IP 地址后，与服务器建立 TCP 连接。

2. TCP 3 次握手连接：

浏览器所在的客户机向服务器发出连续请求报文（SYN 标志为 1）；

服务器接收报文后，同意建立连接，向客户机发出确认报文（SYN，ACK标志位均为 1）；

客户机接收到确认报文后，再次向服务器发出报文，确认已接收到确认报文，此时客户机与服务器之间的 TCP 连接建立完成，开始通信。

## 第四步、浏览器通过 http 协议发送请求

浏览器向主机发送一个 HTTP-GET 请求报文。

其中包括访问的 URL，也就是 `http://www.csdn.com`，KeepAlive，长连接，还有 User-Agent 用户浏览器操作信息，编码等。

值得一提的是 Accept-Encoding 和 Cookies 项。Accept-Encoding 一般采用 gzip，压缩之后传输 html 文件。Cookies 如果是首次访问，会提示服务器建立用户缓存信息，如果不是，可以利用 Cookies 对应键值，找到相应缓存，缓存里面放着用户名，密码和一些用户设置项。

## 第五步、某些服务会做永久重定向

对于大型网站存在多个主机站点，为了负载均衡或导入流量，提高 SEO 排名，往往不会直接返回请求页面，而是重定向。返回的状态码不是 200，而是 301、302 以 3 开头的重定向码，浏览器在获取了重定向响应后，在响应报文 Location 项找到重定向地址，浏览器重新第一步访问即可。

### 重定向的作用

重定向是为了负载均衡或者导入流量，提高 SEO 排名。利用一个前端服务器接受请求，然后负载到不同的主机上，可以大大提高站点的业务并发处理能力；重定向也可将多个域名的访问，集中到一个站点；由于 `baidu.com` 和 `www.baidu.com` 会被搜索引擎认为是两个网站，造成每个的链接数都会减少而减低排名，永久重定向会将两个地址关联起来，搜索引擎会认为是同一个网站，从而提高排名。

## 第六步、浏览器跟踪重定向地址

当浏览器知道了重定向后最终访问的地址之后，便重新发一个 http 请求，发送内容同上。

## 第七步、服务器处理请求

服务器接收到获取请求，然后处理并返回响应。

## 第八步、服务器发出一个 HTML 响应

返回状态码 200，表示服务器可以响应请求，返回报文，由于在报文中 `Content-Type:text/html`，浏览器以 HTML 形式呈现，而不是下载文件。

## 第九步、释放 TCP 链接

1. 浏览器所在主机向服务器发出连接释放报文，然后停止发送数据；

2. 服务器接收到释放报文后发出确认报文，然后将服务器上未传送完的数据发送完；

3. 服务器数据传输完毕后，向客户机发送连接释放报文；

4. 客户机接收到报文后，发出确认，然后等待一段时间后，释放TCP连接。

## 第十步、浏览器显示页面

在浏览器没有完整接收全部 HTML 文档时，它就已经开始渲染这个页面了，浏览器接收到返回的数据包，根据浏览器的渲染机制对响应的数据进行渲染。渲染后的数据，进行响应的页面呈现和脚本交互。

## 第十一步、浏览器发送获取嵌入在 HTML 中的其他内容

比如一些样式文件，图片 url，js 文件 url 等，浏览器会通过这些 url 重新发送请求，请求过程依然是 HTML 读取类似的过程，查询域名，发送请求，重定向等。不过这些静态文件是可以缓存到浏览器中的，有时访问这些文件不需要通过服务器，直接从缓存中取。某些网站也会使用第三方CDN进行托管这些静态文件。


#### [传送门：在浏览器地址栏输入URL，按下回车后究竟发生了什么？](https://blog.csdn.net/jiao_0509/article/details/82491299)