# 















## 重放攻击
重放攻击(Replay Attract)又称重播攻击、回放攻击或新鲜性攻击(Freshness Attract)，是指攻击者发送一个目的主机已接收过的包，来达到欺骗系统的目的，主要用于身份认证过程，破坏认证的正确性。  
它是一种攻击类型，这种攻击会不断恶意或欺诈性地重复一个有效的数据传输，重放攻击可以由发起者，也可以由拦截并重发该数据的敌方进行。攻击者利用网络监听或者其他方式盗取认证凭据，之后再把它重新发给认证服务器。从这个解释上理解，加密可以有效防止会话劫持，但是却防不了重放攻击。重放攻击在任何网络通讯过程中都可能发生，是计算机世界黑客常用的攻击方式之一。

&emsp;

## nonce
nonce 是由服务器生成的一个随机数。在客户端第一次发送请求时将其返回给客户端，客户端拿到这个 nonce，将其与用户密码串联在一起进行非可对称加密(md5,sha1等)，然后将这个加密后的字符串和用户名、nonce、加密算法名称一起发回服务器。  
服务器使用接收到的用户名到数据库搜索密码，然后跟客户端使用同样的算法名称对其进行加密，接着将其与客户端提交上来的加密字符串进行比较，如果两个字符串一致就表示用户身份有效。  
这样就避免了用户密码明文被窃取的问题，攻击者就算知道了算法名和nonce也无法解密出密码。

&emsp;

每个 nonce 只能供一个用户使用一次，这样就可以防止攻击者使用重放攻击，因为该 Http 报文已经失效。可选的实现方式是把每一次请求的 nonce 保存到数据库，客户端再一次提交请求时将请求头中的 nonce 与数据库中的数据对比，如果该 nonce 已存在，那么此次请求可能是恶意的。  
但是当后续请求数多了之后，可能存在两次正常的资源请求中，nonce 的值是相同的。保险起见，最好额外引入一个参数 Timestamp (时间戳)。相同的 nonce 在不同的时间生成，以此进行区分。  
这样的话还有另一个问题，数据库中的记录数会只增不减，增加了维护成本和比对时间。对于这种情况可以定时将数据库中超过一天的数据进行清除，同时也对携带超过一天时间戳的请求进行拦截。

&emsp;

不过一般 nonce 只用于登录认证流程中，登录成功后服务端会颁发一个有固定有效期的 token 值给客户端，其他接口的调用就提供这个 token 给服务端即可。